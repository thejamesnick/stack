STACK - SIMPLIFIED AUTHENTICATION FLOW
=======================================

YES! You're absolutely right! ğŸ¯

================================================================================
AUTO-FID DETECTION (The Smart Way)
================================================================================

When user opens Stack app:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. CHECK CONTEXT                                                        â”‚
â”‚    - Is user in Farcaster app? (Warpcast)                              â”‚
â”‚    - Is user in Base app?                                               â”‚
â”‚    - Is user on web?                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IF IN FARCASTER APP (Warpcast):
================================
âœ¨ AUTOMATIC - NO LOGIN NEEDED!

1. Detect Farcaster context (using Farcaster SDK)
2. Get FID automatically from the app
3. Fetch user profile (username, pfp, bio)
4. Check database:
   - User exists? â†’ Load their data
   - New user? â†’ Create user record with FID
5. Store FID in session
6. Show onboarding (if first time)
7. Ask to connect wallet â†’ Start saving!

BENEFITS:
âœ… Zero-click authentication
âœ… User already identified by FID
âœ… Seamless experience
âœ… All social features enabled


IF IN BASE APP:
===============
Similar auto-detection:

1. Detect Base app context (using Coinbase SDK)
2. Get connected wallet automatically
3. Check if wallet is linked to a FID:
   - Has FID? â†’ Load user data
   - No FID? â†’ Prompt to link Farcaster (optional)
4. Store wallet in session
5. Show onboarding (if first time)
6. Start saving!

BENEFITS:
âœ… Automatic wallet connection
âœ… Seamless in Coinbase ecosystem
âœ… Can optionally link Farcaster for social features


================================================================================
UPDATED FLOW
================================================================================

FIRST-TIME USER IN FARCASTER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User opens Stack in Warpcast
   â†“
2. Splash screen (2.5s)
   â†“
3. âœ¨ AUTO-DETECT FID (background, instant)
   - Get FID from Farcaster SDK
   - Create user in database
   â†“
4. Onboarding (3 screens)
   - "Automate Your Savings"
   - "Reach Your Goals"  
   - "Earn While You Save"
   â†“
5. "Connect Your Wallet"
   - Link wallet to FID
   - Verify on Base network
   â†“
6. Dashboard (Empty State)
   - "Create Your First Stack"
   â†“
7. Create Stack â†’ Done!


RETURNING USER IN FARCASTER:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User opens Stack in Warpcast
   â†“
2. Splash screen (2.5s)
   â†“
3. âœ¨ AUTO-DETECT FID (background)
   - Get FID
   - Fetch user data from database
   - Load stacks, balance, etc.
   â†“
4. Loading skeleton (1s)
   â†“
5. Dashboard (with stacks)
   - Ready to use!


================================================================================
TECHNICAL IMPLEMENTATION
================================================================================

FARCASTER SDK DETECTION:
```typescript
// Check if running in Farcaster context
const isFarcaster = typeof window !== 'undefined' && 
                    window.parent !== window;

if (isFarcaster) {
  // Get FID from Farcaster SDK
  const sdk = new FrameSDK();
  const context = await sdk.context;
  const fid = context.user.fid;
  const username = context.user.username;
  const pfpUrl = context.user.pfpUrl;
  
  // Save to database
  await createOrUpdateUser({
    fid,
    username,
    pfp_url: pfpUrl,
    // ... other profile data
  });
  
  // Store in session
  setSession({ fid, username });
}
```

DATABASE FLOW:
```sql
-- Check if user exists
SELECT * FROM users WHERE fid = $1;

-- If not exists, create
INSERT INTO users (fid, username, pfp_url, created_at)
VALUES ($1, $2, $3, NOW());

-- If exists, update profile
UPDATE users 
SET username = $2, pfp_url = $3, updated_at = NOW()
WHERE fid = $1;
```

================================================================================
WHY THIS IS BETTER
================================================================================

OLD WAY (Manual Login):
âŒ User has to click "Sign in with Farcaster"
âŒ Extra step, friction
âŒ Redirect flow
âŒ User might skip

NEW WAY (Auto-detect):
âœ… Instant authentication
âœ… Zero clicks needed
âœ… Seamless experience
âœ… User doesn't even notice
âœ… FID already in database when they hit "Get Started"

================================================================================
WHAT WE NEED
================================================================================

STEP 1: Detect Context
- Check if in Farcaster app
- Check if in Base app
- Fallback to web

STEP 2: Get FID (if Farcaster)
- Use Farcaster SDK
- Extract FID from context
- Get profile data

STEP 3: Database
- Create/update user with FID
- Store session

STEP 4: Wallet Linking
- Only step user sees
- "Connect wallet to start saving"
- Link wallet to existing FID

STEP 5: Done!
- User is fully authenticated
- FID + Wallet linked
- Ready to create stacks

================================================================================
